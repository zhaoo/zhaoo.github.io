{"title":"useEffect - ä¾èµ–å¯¹è±¡æˆ–æ•°ç»„","slug":"useEffect-object-dependent","date":"2021-11-01T15:39:52.000Z","updated":"2021-11-01T15:42:34.776Z","comments":true,"path":"api/articles/useEffect-object-dependent.json","realPath":"/2021/11/01/useEffect-object-dependent/","excerpt":"useEffect ä¾èµ–é¡¹ä¸ºå¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼Œå¼•å‘ä¸æ–­é‡æ¸²æŸ“é—®é¢˜çš„åŸå› åŠè§£æ³•ã€‚","covers":["https://pic.izhaoo.com/20211028202300.jpg"],"cover":"https://pic.izhaoo.com/20210628212702.jpg","content":"<p>useEffect ä¾èµ–é¡¹ä¸ºå¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼Œå¼•å‘ä¸æ–­é‡æ¸²æŸ“é—®é¢˜çš„åŸå› åŠè§£æ³•ã€‚</p>\n<span id=\"more\"></span>\n\n<h3 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h3><p>ä»Šå¤©å°äº†ä¸ªè½®å­ï¼Œå¯¹ç»„ä»¶ä¼ å…¥å‚æ•°ç”Ÿæˆå¯¹åº”çš„åŠ¨ç”»å®ä¾‹ï¼Œå½“å…¥å‚å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ–°å®ä¾‹ã€‚è‡ªç„¶è€Œç„¶æƒ³åˆ°çš„å°±æ˜¯ useEffect ç›‘å¬ props ä¾èµ–äº†ï¼Œå¦‚ï¼š<code>useEffect(() =&gt; &#123; ... &#125;, [props]);</code>ã€‚ç„¶è€Œé‡åˆ°äº†é—®é¢˜ï¼Œæ˜æ˜ä¾èµ–é¡¹ props æ²¡æœ‰å˜åŒ–ï¼Œå´è¿˜æ˜¯åœ¨ä¸åœåœ°é‡æ¸²æŸ“ã€‚</p>\n<p><img  src=\"https://pic.izhaoo.com/20211028202300.jpg\"  ><span class=\"image-caption\">ğŸ˜“</span></p>\n<h3 id=\"åŸå› \"><a href=\"#åŸå› \" class=\"headerlink\" title=\"åŸå› \"></a>åŸå› </h3><p>React ä¸­å„ Hooks å‡½æ•°ä¾èµ–æ•°ç»„ä¼šå°†ä¾èµ–å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¾èµ–ä¸­çš„å€¼åšå¯¹æ¯”ï¼Œå¦‚æœç›¸ç­‰åˆ™ä¸éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œå¦åˆ™é‡æ¸²æŸ“ã€‚ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œæ­¤å¤„çš„å¯¹æ¯”æ˜¯æµ…æ¯”è¾ƒï¼Œå³ <code>Object.is(arg1, arg2)</code>ã€‚å¯¹äºåŸºæœ¬ç±»å‹æ²¡æœ‰é—®é¢˜ï¼Œè€Œç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶ä¼ å…¥çš„å¼•ç”¨ç±»å‹éƒ½ä¼šé‡æ–°å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„å¼•ç”¨åœ°å€ï¼Œè¿™æ—¶å€™åšæµ…æ¯”è¾ƒå°±ä¸ç­‰äº†ï¼Œä»è€Œä¼šè§¦å‘æ¸²æŸ“ã€‚å¦‚æœåœ¨ useEffect ä¸­ä¿®æ”¹äº†å¼•ç”¨ç±»å‹ï¼Œåˆ™å¿…ç„¶ä¼šå¼•å‘æ— é™æ¸²æŸ“çš„é—®é¢˜ã€‚</p>\n<h3 id=\"è§£æ³•\"><a href=\"#è§£æ³•\" class=\"headerlink\" title=\"è§£æ³•\"></a>è§£æ³•</h3><p><strong>è§£æ³•ä¸€</strong></p>\n<p>äº†è§£å®ŒåŸç†åï¼Œè„‘å­é‡Œ 0.1s é—ªè¿‡çš„è§£æ³•å°±æ˜¯ <code>JSON.stringify()</code> äº†ã€‚çœŸå¥½ä½¿ï¼Œæ·±æµ…æ¯”è¾ƒé—®é¢˜ä¸€è§£ä¸€ä¸ªçˆ½ã€‚ç‡ƒé¹…ç†æ€§å‘Šè¯‰æˆ‘ï¼Œä¸èƒ½è¿™ä¹ˆå†™ï¼Œæ–¹æ³•æ˜¯å¥½æ–¹æ³•ï¼Œå°±æ€•åŒè¡Œçœ‹åˆ°ç¬‘æˆ‘æ˜¯å‚»Xã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\">useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [<span class=\"hljs-built_in\">JSON</span>.stringify(object)]);<br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>è€æï¼šä½ TNDè¿˜çœŸæ˜¯ä¸ªå¤©æ‰â€¦</p>\n</blockquote>\n<p><strong>è§£æ³•äºŒ</strong></p>\n<p>å¯ä»¥åŸºäº useRef å’Œæ·±æ¯”è¾ƒæ–¹æ³•æ¥è§£ï¼ŒuseRef çš„ç‰¹æ€§æ˜¯è·¨æ¸²æŸ“å‘¨æœŸç¼“å­˜æ•°æ®ã€‚æ­¤å¤„ç”¨æ¥ç¼“å­˜ä¸Šä¸€æ¬¡æ¸²æŸ“çš„æ•°æ®ï¼Œå¹¶è°ƒç”¨æ·±æ¯”è¾ƒæ–¹æ³•åˆ¤æ–­ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰åˆ™è¿”å›ä¸Šä¸€æ¬¡çš„æ•°æ®ï¼Œåœ°å€è‡ªç„¶ä¹Ÿæ²¡æœ‰å˜åŒ–ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">import</span> &#123; isEqual &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span>;<br><br><span class=\"hljs-keyword\">const</span> useCampare = <span class=\"hljs-function\">(<span class=\"hljs-params\">value: any, compare: any</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> ref = useRef&lt;any&gt;(<span class=\"hljs-literal\">null</span>);<br><br>  <span class=\"hljs-keyword\">if</span> (!compare(value, ref.current)) &#123;  <span class=\"hljs-comment\">// deep compare</span><br>    ref.current = value;<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> ref.current;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> compareObject = useCampare(object, isEqual);<br><br>useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [compareObject]);<br></code></pre></td></tr></table></figure>\n\n<p><strong>è§£æ³•ä¸‰</strong></p>\n<p>å°è£…ä¸€ä¸ªåŸºäºæ·±æ¯”è¾ƒçš„ useEffect æ–¹æ³•ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\">type DeepIsEqualType&lt;TDeps = React.DependencyList&gt; = <span class=\"hljs-function\">(<span class=\"hljs-params\">newDeps: TDeps, oldDeps: TDeps</span>) =&gt;</span> boolean;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> useDeepEqualEffect&lt;TDeps = React.DependencyList&gt; = <span class=\"hljs-function\">(<span class=\"hljs-params\"></span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">  effect: React.EffectCallback,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">  deps: TDeps,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">  compare: DeepIsEqualType&lt;TDeps&gt; = isEqual</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\"></span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> oldDeps = React.useRef&lt;TDeps | <span class=\"hljs-literal\">undefined</span>&gt;(<span class=\"hljs-literal\">undefined</span>);<br>  <span class=\"hljs-keyword\">if</span> (!oldDeps.current || !compare(deps, oldDeps.current <span class=\"hljs-keyword\">as</span> TDeps)) &#123;<br>    oldDeps.current = deps;<br>  &#125;<br><br>  React.useEffect(effect, [oldDeps.current]);<br>&#125;<br><br>useDeepEqualEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [object]);<br></code></pre></td></tr></table></figure>\n\n<p><strong>è§£æ³•å››</strong></p>\n<p>ä½¿ç”¨ä¸‰æ–¹åŸºäºæ·±æ¯”è¾ƒçš„ useEffect åº“ï¼Œå¯¹æ€§èƒ½è¿˜æ˜¯æœ‰ä¸€å®šå½±å“çš„ï¼Œéå¿…é¡»ä¸ç”¨ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">import</span> useDeepCompareEffect <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;use-deep-compare-effect&#x27;</span>;<br><br>useDeepCompareEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [object]);<br></code></pre></td></tr></table></figure>","more":"<h3 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h3><p>ä»Šå¤©å°äº†ä¸ªè½®å­ï¼Œå¯¹ç»„ä»¶ä¼ å…¥å‚æ•°ç”Ÿæˆå¯¹åº”çš„åŠ¨ç”»å®ä¾‹ï¼Œå½“å…¥å‚å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ–°å®ä¾‹ã€‚è‡ªç„¶è€Œç„¶æƒ³åˆ°çš„å°±æ˜¯ useEffect ç›‘å¬ props ä¾èµ–äº†ï¼Œå¦‚ï¼š<code>useEffect(() =&gt; &#123; ... &#125;, [props]);</code>ã€‚ç„¶è€Œé‡åˆ°äº†é—®é¢˜ï¼Œæ˜æ˜ä¾èµ–é¡¹ props æ²¡æœ‰å˜åŒ–ï¼Œå´è¿˜æ˜¯åœ¨ä¸åœåœ°é‡æ¸²æŸ“ã€‚</p>\n<p><img  src=\"https://pic.izhaoo.com/20211028202300.jpg\"  ><span class=\"image-caption\">ğŸ˜“</span></p>\n<h3 id=\"åŸå› \"><a href=\"#åŸå› \" class=\"headerlink\" title=\"åŸå› \"></a>åŸå› </h3><p>React ä¸­å„ Hooks å‡½æ•°ä¾èµ–æ•°ç»„ä¼šå°†ä¾èµ–å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¾èµ–ä¸­çš„å€¼åšå¯¹æ¯”ï¼Œå¦‚æœç›¸ç­‰åˆ™ä¸éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œå¦åˆ™é‡æ¸²æŸ“ã€‚ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œæ­¤å¤„çš„å¯¹æ¯”æ˜¯æµ…æ¯”è¾ƒï¼Œå³ <code>Object.is(arg1, arg2)</code>ã€‚å¯¹äºåŸºæœ¬ç±»å‹æ²¡æœ‰é—®é¢˜ï¼Œè€Œç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶ä¼ å…¥çš„å¼•ç”¨ç±»å‹éƒ½ä¼šé‡æ–°å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„å¼•ç”¨åœ°å€ï¼Œè¿™æ—¶å€™åšæµ…æ¯”è¾ƒå°±ä¸ç­‰äº†ï¼Œä»è€Œä¼šè§¦å‘æ¸²æŸ“ã€‚å¦‚æœåœ¨ useEffect ä¸­ä¿®æ”¹äº†å¼•ç”¨ç±»å‹ï¼Œåˆ™å¿…ç„¶ä¼šå¼•å‘æ— é™æ¸²æŸ“çš„é—®é¢˜ã€‚</p>\n<h3 id=\"è§£æ³•\"><a href=\"#è§£æ³•\" class=\"headerlink\" title=\"è§£æ³•\"></a>è§£æ³•</h3><p><strong>è§£æ³•ä¸€</strong></p>\n<p>äº†è§£å®ŒåŸç†åï¼Œè„‘å­é‡Œ 0.1s é—ªè¿‡çš„è§£æ³•å°±æ˜¯ <code>JSON.stringify()</code> äº†ã€‚çœŸå¥½ä½¿ï¼Œæ·±æµ…æ¯”è¾ƒé—®é¢˜ä¸€è§£ä¸€ä¸ªçˆ½ã€‚ç‡ƒé¹…ç†æ€§å‘Šè¯‰æˆ‘ï¼Œä¸èƒ½è¿™ä¹ˆå†™ï¼Œæ–¹æ³•æ˜¯å¥½æ–¹æ³•ï¼Œå°±æ€•åŒè¡Œçœ‹åˆ°ç¬‘æˆ‘æ˜¯å‚»Xã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\">useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [<span class=\"hljs-built_in\">JSON</span>.stringify(object)]);<br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>è€æï¼šä½ TNDè¿˜çœŸæ˜¯ä¸ªå¤©æ‰â€¦</p>\n</blockquote>\n<p><strong>è§£æ³•äºŒ</strong></p>\n<p>å¯ä»¥åŸºäº useRef å’Œæ·±æ¯”è¾ƒæ–¹æ³•æ¥è§£ï¼ŒuseRef çš„ç‰¹æ€§æ˜¯è·¨æ¸²æŸ“å‘¨æœŸç¼“å­˜æ•°æ®ã€‚æ­¤å¤„ç”¨æ¥ç¼“å­˜ä¸Šä¸€æ¬¡æ¸²æŸ“çš„æ•°æ®ï¼Œå¹¶è°ƒç”¨æ·±æ¯”è¾ƒæ–¹æ³•åˆ¤æ–­ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰åˆ™è¿”å›ä¸Šä¸€æ¬¡çš„æ•°æ®ï¼Œåœ°å€è‡ªç„¶ä¹Ÿæ²¡æœ‰å˜åŒ–ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">import</span> &#123; isEqual &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;lodash&#x27;</span>;<br><br><span class=\"hljs-keyword\">const</span> useCampare = <span class=\"hljs-function\">(<span class=\"hljs-params\">value: any, compare: any</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> ref = useRef&lt;any&gt;(<span class=\"hljs-literal\">null</span>);<br><br>  <span class=\"hljs-keyword\">if</span> (!compare(value, ref.current)) &#123;  <span class=\"hljs-comment\">// deep compare</span><br>    ref.current = value;<br>  &#125;<br><br>  <span class=\"hljs-keyword\">return</span> ref.current;<br>&#125;<br><br><span class=\"hljs-keyword\">const</span> compareObject = useCampare(object, isEqual);<br><br>useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [compareObject]);<br></code></pre></td></tr></table></figure>\n\n<p><strong>è§£æ³•ä¸‰</strong></p>\n<p>å°è£…ä¸€ä¸ªåŸºäºæ·±æ¯”è¾ƒçš„ useEffect æ–¹æ³•ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\">type DeepIsEqualType&lt;TDeps = React.DependencyList&gt; = <span class=\"hljs-function\">(<span class=\"hljs-params\">newDeps: TDeps, oldDeps: TDeps</span>) =&gt;</span> boolean;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> useDeepEqualEffect&lt;TDeps = React.DependencyList&gt; = <span class=\"hljs-function\">(<span class=\"hljs-params\"></span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">  effect: React.EffectCallback,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">  deps: TDeps,</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\">  compare: DeepIsEqualType&lt;TDeps&gt; = isEqual</span></span><br><span class=\"hljs-params\"><span class=\"hljs-function\"></span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> oldDeps = React.useRef&lt;TDeps | <span class=\"hljs-literal\">undefined</span>&gt;(<span class=\"hljs-literal\">undefined</span>);<br>  <span class=\"hljs-keyword\">if</span> (!oldDeps.current || !compare(deps, oldDeps.current <span class=\"hljs-keyword\">as</span> TDeps)) &#123;<br>    oldDeps.current = deps;<br>  &#125;<br><br>  React.useEffect(effect, [oldDeps.current]);<br>&#125;<br><br>useDeepEqualEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [object]);<br></code></pre></td></tr></table></figure>\n\n<p><strong>è§£æ³•å››</strong></p>\n<p>ä½¿ç”¨ä¸‰æ–¹åŸºäºæ·±æ¯”è¾ƒçš„ useEffect åº“ï¼Œå¯¹æ€§èƒ½è¿˜æ˜¯æœ‰ä¸€å®šå½±å“çš„ï¼Œéå¿…é¡»ä¸ç”¨ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">import</span> useDeepCompareEffect <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;use-deep-compare-effect&#x27;</span>;<br><br>useDeepCompareEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>  ...<br>&#125;, [object]);<br></code></pre></td></tr></table></figure>","categories":[{"name":"å‰ç«¯","path":"api/categories/å‰ç«¯.json"}],"tags":[{"name":"å‰ç«¯","path":"api/tags/å‰ç«¯.json"},{"name":"React","path":"api/tags/React.json"}]}