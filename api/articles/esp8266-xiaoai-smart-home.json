{"title":"ESP8266 - 小爱同学智能家居","slug":"esp8266-xiaoai-smart-home","date":"2021-07-10T14:54:27.000Z","updated":"2021-07-15T14:53:39.361Z","comments":true,"path":"api/articles/esp8266-xiaoai-smart-home.json","realPath":"/2021/07/10/esp8266-xiaoai-smart-home/","excerpt":"基于 ESP8266 和 Blinker 组件智能家居，使用小爱同学控制普通空调和电视机等设备。","covers":["https://pic.izhaoo.com/20201022171055529.png","https://pic.izhaoo.com/20210710222545.png","https://pic.izhaoo.com/20210710220836.png","https://pic.izhaoo.com/20210710220816.png","https://pic.izhaoo.com/20210710221315.png","https://pic.izhaoo.com/20210710221709.png","https://pic.izhaoo.com/20210715144417.jpg","https://pic.izhaoo.com/20210710221905.png","https://pic.izhaoo.com/20210710221922.png","https://pic.izhaoo.com/20210710221934.png","https://pic.izhaoo.com/20210710222323.png","https://pic.izhaoo.com/20210715141625.jpg","https://pic.izhaoo.com/20210715142207.jpg","https://pic.izhaoo.com/20210715143716.jpg","https://pic.izhaoo.com/20210715143910.jpg","https://pic.izhaoo.com/20210715144057.jpg"],"cover":"https://pic.izhaoo.com/20210628211131.jpg","content":"<p>基于 ESP8266 和 Blinker 组件智能家居，使用小爱同学控制普通空调和电视机等设备。</p>\n<span id=\"more\"></span>\n\n<p>&lt;封面摄于新疆·禾木的山间，高原下的寒松和草甸一片苍翠欲滴，哈萨克牧民就在山麓和山顶间来回迁徙。&gt;</p>\n<p>最近打工人搬进了出租房，闲鱼捡了个小爱触屏音箱，一百来块钱居然可以组 Mesh 网络，遂决定撘一套智能家居。可是这儿的空调、电视等都是传统设备，不支持物联网，改线又会被房东打死。唯一的办法就是借助红外遥控实现，搜了一下小米万能红外遥控器居然要一百多块钱，咋不去抢钱呢。于是默默地翻出积灰的电子元器件箱，掏出了几年前买的 ESP8266 板子，自己做一个吧，八要钱。</p>\n<p>下面以控制 LG 空调为例，整套智能家居架构如下：</p>\n<p>小爱触屏音箱 → Blinker（IRremote） → 电气设备</p>\n<ol>\n<li>米家接入 Bliker（点灯科技）物联网平台。</li>\n<li>ESP8266 刷入 Blinker 固件，作为物联网终端。</li>\n<li>ESP8266 基于 IRremote 库发射红外信号，控制空调等设备。</li>\n</ol>\n<h2 id=\"接线\"><a href=\"#接线\" class=\"headerlink\" title=\"接线\"></a>接线</h2><p>需要准备以下硬件，按如下方式接线：</p>\n<ul>\n<li>ESP8266 开发板（NodeMUC）</li>\n<li>红外二极管</li>\n<li>100Ω 电阻</li>\n<li>面包线（母对母）若干</li>\n</ul>\n<p><img  src=\"https://pic.izhaoo.com/20201022171055529.png\"  ><span class=\"image-caption\">接线图</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210710222545.png\"  ><span class=\"image-caption\">接好后，很挫</span></p>\n<h2 id=\"Blinker\"><a href=\"#Blinker\" class=\"headerlink\" title=\"Blinker\"></a>Blinker</h2><p><a href=\"https://www.diandeng.tech/home\">点灯科技</a></p>\n<p>首先在手机上安装点灯 APP 并打开。</p>\n<p>点击右上角加号添加设备，选择 <em>独立设备</em> → <em>网络接入</em> → <em>点灯科技</em>，把 <strong>key</strong> 保存一下，后面需要用到。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710220836.png\"  ><span class=\"image-caption\">添加设备</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210710220816.png\"  ><span class=\"image-caption\">独立设备</span></p>\n<p>点击右上角的编辑，定制遥控界面。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221315.png\"  ><span class=\"image-caption\">编辑遥控界面</span></p>\n<p>点击右上角的三个点，可以重命名设备，方便之后语言控制。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221709.png\"  ><span class=\"image-caption\">重命名设备</span></p>\n<p>在 Blinker APP 中编辑按钮，添加语音指令。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210715144417.jpg\"  ><span class=\"image-caption\">语音指令</span></p>\n<h2 id=\"米家\"><a href=\"#米家\" class=\"headerlink\" title=\"米家\"></a>米家</h2><p>打开米家 APP，在 <em>我的</em> 页面，点击 <em>其他平台设备</em>，点击 <em>添加设备</em>，拉下来选择 <em>点灯科技</em>。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221905.png\"  ><span class=\"image-caption\">其他平台设备</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221922.png\"  ><span class=\"image-caption\">点灯科技</span></p>\n<p>输入点灯科技注册的账号和密码，绑定账号。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221934.png\"  ><span class=\"image-caption\">绑定账号</span></p>\n<p>点击同步设备，可以发现刚才在点灯平台添加的设备。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710222323.png\"  ><span class=\"image-caption\">同步设备</span></p>\n<h2 id=\"刷入固件\"><a href=\"#刷入固件\" class=\"headerlink\" title=\"刷入固件\"></a>刷入固件</h2><p>首先下载并安装 <a href=\"http://www.arduino.cn/thread-5838-1-1.html\">Arduion-IDE</a> 打开，我们需要安装 ESP8266 相关库。</p>\n<p>在 <em>文件 → 首选项 → 附加开发板管理配置</em> 中添加 ESP8266 的官方源：<code>http://arduino.esp8266.com/stable/package_esp8266com_index.json</code></p>\n<p><img  src=\"https://pic.izhaoo.com/20210715141625.jpg\"  ><span class=\"image-caption\">添加源</span></p>\n<p><del>然后在 <em>工具 → 管理包</em> 中搜索 <code>IRremoteESP8266</code> 安装这个包，用来控制输出红外信号的。</del></p>\n<p><img  src=\"https://pic.izhaoo.com/20210715142207.jpg\"  ><span class=\"image-caption\">安装 IRremoteESP8266</span></p>\n<p>也可以直接在 GitHub 下载 master 分支文件，丢到 <code>Arduino安装目录\\Arduino\\libraries</code> 目录下，需要下载以下包：</p>\n<ul>\n<li><a href=\"https://github.com/crankyoldgit/IRremoteESP8266\">IRremoteESP8266</a></li>\n<li><a href=\"https://github.com/blinker-iot/blinker-library\">blinker-library</a></li>\n</ul>\n<p>然后在编辑器中输入以下代码：</p>\n<pre><code class=\"c\">#define BLINKER_PRINT Serial\n#define BLINKER_WIFI\n#define BLINKER_MIOT_LIGHT\n\n#include &lt;ESP8266WiFi.h&gt;\n#include &lt;IRremoteESP8266.h&gt;\n#include &lt;IRsend.h&gt;\n#include &lt;ir_LG.h&gt;  // 换成对应型号空调\n#include &lt;Blinker.h&gt;\n\nchar auth[] = &quot;**********&quot;;  // Bliker key\nchar ssid[] = &quot;**********&quot;;  // WiFi 名称\nchar pswd[] = &quot;**********&quot;;  // WiFi 密码\n\nBlinkerButton Button1(&quot;btn-abc&quot;);  // 按钮名称换成 Blinker 中设置的名称\nIRLgAc _ac(D3);  // D3 对应开发板上火线口\n\n\n// 按钮\nvoid button1_callback(const String &amp; state) &#123;\n  BLINKER_LOG(&quot;get button state: &quot;, state);\n  if (state == &quot;on&quot;) &#123;\n    digitalWrite(LED_BUILTIN, LOW);\n    Button1.print(&quot;on&quot;);\n    IRLgAc _ac(D3);\n    _ac.begin();\n    _ac.on();\n    _ac.send();\n  &#125; else if (state == &quot;off&quot;) &#123;\n\n    digitalWrite(LED_BUILTIN, HIGH);\n    Button1.print(&quot;off&quot;);\n    IRLgAc _ac(D3);\n    _ac.begin();\n    _ac.off();\n    _ac.send();\n  &#125;\n&#125;\n\n//小爱\nvoid miotPowerState(const String &amp; state)\n&#123;\n  BLINKER_LOG(&quot;need set power state: &quot;, state);\n\n  if (state == BLINKER_CMD_ON) &#123;\n    digitalWrite(LED_BUILTIN, LOW);\n    BlinkerMIOT.powerState(&quot;on&quot;);\n    BlinkerMIOT.print();\n    IRLgAc _ac(D3);\n    _ac.begin();\n    _ac.on();\n    _ac.send();\n  &#125;\n  else if (state == BLINKER_CMD_OFF) &#123;\n    digitalWrite(LED_BUILTIN, HIGH);\n    BlinkerMIOT.powerState(&quot;off&quot;);\n    BlinkerMIOT.print();\n    IRLgAc _ac(D3);\n    _ac.off();\n    _ac.send();\n  &#125;\n&#125;\n\nvoid setup() &#123;\n  Serial.begin(115200);\n  BLINKER_DEBUG.stream(Serial);\n  pinMode(LED_BUILTIN, OUTPUT);\n  digitalWrite(LED_BUILTIN, HIGH);\n  Blinker.begin(auth, ssid, pswd);\n  Button1.attach(button1_callback);\n  BlinkerMIOT.attachPowerState(miotPowerState);\n\n&#125;\n\nvoid loop() &#123;\n  Blinker.run();\n&#125;</code></pre>\n<p>然后用 USB 线连接至电脑，点击输入按钮刷入即可。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210715143716.jpg\"  ><span class=\"image-caption\">输入固件</span></p>\n<p>可以在 [IRremoteESP8266 包的目录下找到几乎所有型号的空调，更改一下代码即可。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210715143910.jpg\"  ><span class=\"image-caption\">空调型号</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210715144057.jpg\"  ><span class=\"image-caption\">类名</span></p>\n<h3 id=\"开始装逼\"><a href=\"#开始装逼\" class=\"headerlink\" title=\"开始装逼\"></a>开始装逼</h3><p>一切都妥当后，将 ESP8266 和小爱同学连接至同一 WiFi 下。唤起小爱同学，输入刚才编辑的语音指令，即可发送红外信号控制电器设备。</p>\n<p>这里只是简单地示范了一下开/关 LG 空调，后续请学习相关库的文档，自行开启高阶能力。</p>\n","more":"<p>&lt;封面摄于新疆·禾木的山间，高原下的寒松和草甸一片苍翠欲滴，哈萨克牧民就在山麓和山顶间来回迁徙。&gt;</p>\n<p>最近打工人搬进了出租房，闲鱼捡了个小爱触屏音箱，一百来块钱居然可以组 Mesh 网络，遂决定撘一套智能家居。可是这儿的空调、电视等都是传统设备，不支持物联网，改线又会被房东打死。唯一的办法就是借助红外遥控实现，搜了一下小米万能红外遥控器居然要一百多块钱，咋不去抢钱呢。于是默默地翻出积灰的电子元器件箱，掏出了几年前买的 ESP8266 板子，自己做一个吧，八要钱。</p>\n<p>下面以控制 LG 空调为例，整套智能家居架构如下：</p>\n<p>小爱触屏音箱 → Blinker（IRremote） → 电气设备</p>\n<ol>\n<li>米家接入 Bliker（点灯科技）物联网平台。</li>\n<li>ESP8266 刷入 Blinker 固件，作为物联网终端。</li>\n<li>ESP8266 基于 IRremote 库发射红外信号，控制空调等设备。</li>\n</ol>\n<h2 id=\"接线\"><a href=\"#接线\" class=\"headerlink\" title=\"接线\"></a>接线</h2><p>需要准备以下硬件，按如下方式接线：</p>\n<ul>\n<li>ESP8266 开发板（NodeMUC）</li>\n<li>红外二极管</li>\n<li>100Ω 电阻</li>\n<li>面包线（母对母）若干</li>\n</ul>\n<p><img  src=\"https://pic.izhaoo.com/20201022171055529.png\"  ><span class=\"image-caption\">接线图</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210710222545.png\"  ><span class=\"image-caption\">接好后，很挫</span></p>\n<h2 id=\"Blinker\"><a href=\"#Blinker\" class=\"headerlink\" title=\"Blinker\"></a>Blinker</h2><p><a href=\"https://www.diandeng.tech/home\">点灯科技</a></p>\n<p>首先在手机上安装点灯 APP 并打开。</p>\n<p>点击右上角加号添加设备，选择 <em>独立设备</em> → <em>网络接入</em> → <em>点灯科技</em>，把 <strong>key</strong> 保存一下，后面需要用到。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710220836.png\"  ><span class=\"image-caption\">添加设备</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210710220816.png\"  ><span class=\"image-caption\">独立设备</span></p>\n<p>点击右上角的编辑，定制遥控界面。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221315.png\"  ><span class=\"image-caption\">编辑遥控界面</span></p>\n<p>点击右上角的三个点，可以重命名设备，方便之后语言控制。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221709.png\"  ><span class=\"image-caption\">重命名设备</span></p>\n<p>在 Blinker APP 中编辑按钮，添加语音指令。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210715144417.jpg\"  ><span class=\"image-caption\">语音指令</span></p>\n<h2 id=\"米家\"><a href=\"#米家\" class=\"headerlink\" title=\"米家\"></a>米家</h2><p>打开米家 APP，在 <em>我的</em> 页面，点击 <em>其他平台设备</em>，点击 <em>添加设备</em>，拉下来选择 <em>点灯科技</em>。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221905.png\"  ><span class=\"image-caption\">其他平台设备</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221922.png\"  ><span class=\"image-caption\">点灯科技</span></p>\n<p>输入点灯科技注册的账号和密码，绑定账号。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710221934.png\"  ><span class=\"image-caption\">绑定账号</span></p>\n<p>点击同步设备，可以发现刚才在点灯平台添加的设备。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210710222323.png\"  ><span class=\"image-caption\">同步设备</span></p>\n<h2 id=\"刷入固件\"><a href=\"#刷入固件\" class=\"headerlink\" title=\"刷入固件\"></a>刷入固件</h2><p>首先下载并安装 <a href=\"http://www.arduino.cn/thread-5838-1-1.html\">Arduion-IDE</a> 打开，我们需要安装 ESP8266 相关库。</p>\n<p>在 <em>文件 → 首选项 → 附加开发板管理配置</em> 中添加 ESP8266 的官方源：<code>http://arduino.esp8266.com/stable/package_esp8266com_index.json</code></p>\n<p><img  src=\"https://pic.izhaoo.com/20210715141625.jpg\"  ><span class=\"image-caption\">添加源</span></p>\n<p><del>然后在 <em>工具 → 管理包</em> 中搜索 <code>IRremoteESP8266</code> 安装这个包，用来控制输出红外信号的。</del></p>\n<p><img  src=\"https://pic.izhaoo.com/20210715142207.jpg\"  ><span class=\"image-caption\">安装 IRremoteESP8266</span></p>\n<p>也可以直接在 GitHub 下载 master 分支文件，丢到 <code>Arduino安装目录\\Arduino\\libraries</code> 目录下，需要下载以下包：</p>\n<ul>\n<li><a href=\"https://github.com/crankyoldgit/IRremoteESP8266\">IRremoteESP8266</a></li>\n<li><a href=\"https://github.com/blinker-iot/blinker-library\">blinker-library</a></li>\n</ul>\n<p>然后在编辑器中输入以下代码：</p>\n<pre><code class=\"c\">#define BLINKER_PRINT Serial\n#define BLINKER_WIFI\n#define BLINKER_MIOT_LIGHT\n\n#include &lt;ESP8266WiFi.h&gt;\n#include &lt;IRremoteESP8266.h&gt;\n#include &lt;IRsend.h&gt;\n#include &lt;ir_LG.h&gt;  // 换成对应型号空调\n#include &lt;Blinker.h&gt;\n\nchar auth[] = &quot;**********&quot;;  // Bliker key\nchar ssid[] = &quot;**********&quot;;  // WiFi 名称\nchar pswd[] = &quot;**********&quot;;  // WiFi 密码\n\nBlinkerButton Button1(&quot;btn-abc&quot;);  // 按钮名称换成 Blinker 中设置的名称\nIRLgAc _ac(D3);  // D3 对应开发板上火线口\n\n\n// 按钮\nvoid button1_callback(const String &amp; state) &#123;\n  BLINKER_LOG(&quot;get button state: &quot;, state);\n  if (state == &quot;on&quot;) &#123;\n    digitalWrite(LED_BUILTIN, LOW);\n    Button1.print(&quot;on&quot;);\n    IRLgAc _ac(D3);\n    _ac.begin();\n    _ac.on();\n    _ac.send();\n  &#125; else if (state == &quot;off&quot;) &#123;\n\n    digitalWrite(LED_BUILTIN, HIGH);\n    Button1.print(&quot;off&quot;);\n    IRLgAc _ac(D3);\n    _ac.begin();\n    _ac.off();\n    _ac.send();\n  &#125;\n&#125;\n\n//小爱\nvoid miotPowerState(const String &amp; state)\n&#123;\n  BLINKER_LOG(&quot;need set power state: &quot;, state);\n\n  if (state == BLINKER_CMD_ON) &#123;\n    digitalWrite(LED_BUILTIN, LOW);\n    BlinkerMIOT.powerState(&quot;on&quot;);\n    BlinkerMIOT.print();\n    IRLgAc _ac(D3);\n    _ac.begin();\n    _ac.on();\n    _ac.send();\n  &#125;\n  else if (state == BLINKER_CMD_OFF) &#123;\n    digitalWrite(LED_BUILTIN, HIGH);\n    BlinkerMIOT.powerState(&quot;off&quot;);\n    BlinkerMIOT.print();\n    IRLgAc _ac(D3);\n    _ac.off();\n    _ac.send();\n  &#125;\n&#125;\n\nvoid setup() &#123;\n  Serial.begin(115200);\n  BLINKER_DEBUG.stream(Serial);\n  pinMode(LED_BUILTIN, OUTPUT);\n  digitalWrite(LED_BUILTIN, HIGH);\n  Blinker.begin(auth, ssid, pswd);\n  Button1.attach(button1_callback);\n  BlinkerMIOT.attachPowerState(miotPowerState);\n\n&#125;\n\nvoid loop() &#123;\n  Blinker.run();\n&#125;</code></pre>\n<p>然后用 USB 线连接至电脑，点击输入按钮刷入即可。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210715143716.jpg\"  ><span class=\"image-caption\">输入固件</span></p>\n<p>可以在 [IRremoteESP8266 包的目录下找到几乎所有型号的空调，更改一下代码即可。</p>\n<p><img  src=\"https://pic.izhaoo.com/20210715143910.jpg\"  ><span class=\"image-caption\">空调型号</span></p>\n<p><img  src=\"https://pic.izhaoo.com/20210715144057.jpg\"  ><span class=\"image-caption\">类名</span></p>\n<h3 id=\"开始装逼\"><a href=\"#开始装逼\" class=\"headerlink\" title=\"开始装逼\"></a>开始装逼</h3><p>一切都妥当后，将 ESP8266 和小爱同学连接至同一 WiFi 下。唤起小爱同学，输入刚才编辑的语音指令，即可发送红外信号控制电器设备。</p>\n<p>这里只是简单地示范了一下开/关 LG 空调，后续请学习相关库的文档，自行开启高阶能力。</p>","categories":[{"name":"技术","path":"api/categories/技术.json"}],"tags":[{"name":"arduino","path":"api/tags/arduino.json"},{"name":"esp8266","path":"api/tags/esp8266.json"},{"name":"IoT","path":"api/tags/IoT.json"},{"name":"智能家居","path":"api/tags/智能家居.json"}]}