{"title":"Ubuntu开启BBR加速","slug":"ubuntu-install-bbr","date":"2017-09-27T13:44:47.000Z","updated":"2020-04-30T03:58:08.000Z","comments":true,"path":"api/articles/ubuntu-install-bbr.json","realPath":"/2017/09/27/ubuntu-install-bbr/","excerpt":"Ubuntu升级内核，开启BBR网络加速。","covers":["https://pic.izhaoo.com/20170927215315.jpg","https://pic.izhaoo.com/20170927215720.jpg","https://pic.izhaoo.com/20170927220209.jpg","https://pic.izhaoo.com/20170927220631.jpg","https://pic.izhaoo.com/20170927220809.jpg","https://pic.izhaoo.com/20170927221102.jpg","https://pic.izhaoo.com/20170927221352.jpg"],"cover":"https://pic.izhaoo.com/20191211065124.jpg","content":"<p>Ubuntu升级内核，开启BBR网络加速。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"BBR\"><a href=\"#BBR\" class=\"headerlink\" title=\"BBR\"></a>BBR</h1><p>BBR是谷歌最近研发的一项技术，拥塞控制算法。原理是尽量跑满带宽, 并且尽量不要有排队的情况。可以比喻为你家马桶堵了，找根搅屎棍给他通了，屎冲的不就快了。<del>（谷歌别揍我，我是个粗人，想不到好的比喻）</del></p>\n<p>在最新内核的Linux系统上你默认配备BBR技术的。所以我们只需给老版本的系统升级最新内核，然后开启BBR即可。</p>\n<p>我的服务器是运行在阿里云上的Ubuntu 14.04。另外，据说采用OpenVZ虚拟技术的VPS不适合开启BBR，BUG多。</p>\n<h1 id=\"升级Ubuntu内核\"><a href=\"#升级Ubuntu内核\" class=\"headerlink\" title=\"升级Ubuntu内核\"></a>升级Ubuntu内核</h1><p>查看当前内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">uname -r<br></code></pre></td></tr></table></figure>\n\n<p>如果返回结果 &lt;= 4.9 的话，说明我们需要升级内核了。</p>\n<p>查看系统是32位还是64位：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">arch<br></code></pre></td></tr></table></figure>\n\n<p>我这是64位，待会儿有用。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927215315.jpg\"  ><span class=\"image-caption\">查看系统版本</span></p>\n<p>访问<a href=\"http://kernel.ubuntu.com/~kernel-ppa/mainline/\">Ubuntu内核网址</a> ，向下拉找到最新发行版，不推荐RC发行候选版哦，点击进入。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927215720.jpg\"  ><span class=\"image-caption\">内核网址</span></p>\n<p>然后根据你的系统版本找到内核下载地址。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927220209.jpg\"  ><span class=\"image-caption\">下载地址</span></p>\n<p>下载内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.13/linux-image-4.13.0-041300-generic_4.13.0-041300.201709031731_amd64.deb<br></code></pre></td></tr></table></figure>\n\n<p><img  src=\"https://pic.izhaoo.com/20170927220631.jpg\"  ><span class=\"image-caption\">下载内核</span></p>\n<p>安装内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">dpkg -i linux-image-4.13.0-041300-generic_4.13.0-041300.201709031731_amd64.deb<br></code></pre></td></tr></table></figure>\n\n<p><img  src=\"https://pic.izhaoo.com/20170927220809.jpg\"  ><span class=\"image-caption\">安装内核</span></p>\n<p>重启查看下内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">shutdown -r now<br><br>uname -r<br></code></pre></td></tr></table></figure>\n\n<p>看到内核版本是最新了（&gt; 4.9），就可以开启BBR加速了。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927221102.jpg\"  ><span class=\"image-caption\">最新内核</span></p>\n<h1 id=\"开启BBR\"><a href=\"#开启BBR\" class=\"headerlink\" title=\"开启BBR\"></a>开启BBR</h1><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;net.core.default_qdisc=fq&quot;</span> &gt;&gt; /etc/sysctl.conf<br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;net.ipv4.tcp_congestion_control=bbr&quot;</span> &gt;&gt; /etc/sysctl.conf<br><br>sysctl -p<br></code></pre></td></tr></table></figure>\n\n<p>查看是否生效：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">sysctl net.ipv4.tcp_available_congestion_control<br></code></pre></td></tr></table></figure>\n\n<p>若返回“net.ipv4.tcp_available_congestion_control = bbr cubic reno”说明成功了。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927221352.jpg\"  ><span class=\"image-caption\">开启BBR</span></p>\n","more":"<h1 id=\"BBR\"><a href=\"#BBR\" class=\"headerlink\" title=\"BBR\"></a>BBR</h1><p>BBR是谷歌最近研发的一项技术，拥塞控制算法。原理是尽量跑满带宽, 并且尽量不要有排队的情况。可以比喻为你家马桶堵了，找根搅屎棍给他通了，屎冲的不就快了。<del>（谷歌别揍我，我是个粗人，想不到好的比喻）</del></p>\n<p>在最新内核的Linux系统上你默认配备BBR技术的。所以我们只需给老版本的系统升级最新内核，然后开启BBR即可。</p>\n<p>我的服务器是运行在阿里云上的Ubuntu 14.04。另外，据说采用OpenVZ虚拟技术的VPS不适合开启BBR，BUG多。</p>\n<h1 id=\"升级Ubuntu内核\"><a href=\"#升级Ubuntu内核\" class=\"headerlink\" title=\"升级Ubuntu内核\"></a>升级Ubuntu内核</h1><p>查看当前内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">uname -r<br></code></pre></td></tr></table></figure>\n\n<p>如果返回结果 &lt;= 4.9 的话，说明我们需要升级内核了。</p>\n<p>查看系统是32位还是64位：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">arch<br></code></pre></td></tr></table></figure>\n\n<p>我这是64位，待会儿有用。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927215315.jpg\"  ><span class=\"image-caption\">查看系统版本</span></p>\n<p>访问<a href=\"http://kernel.ubuntu.com/~kernel-ppa/mainline/\">Ubuntu内核网址</a> ，向下拉找到最新发行版，不推荐RC发行候选版哦，点击进入。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927215720.jpg\"  ><span class=\"image-caption\">内核网址</span></p>\n<p>然后根据你的系统版本找到内核下载地址。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927220209.jpg\"  ><span class=\"image-caption\">下载地址</span></p>\n<p>下载内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.13/linux-image-4.13.0-041300-generic_4.13.0-041300.201709031731_amd64.deb<br></code></pre></td></tr></table></figure>\n\n<p><img  src=\"https://pic.izhaoo.com/20170927220631.jpg\"  ><span class=\"image-caption\">下载内核</span></p>\n<p>安装内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">dpkg -i linux-image-4.13.0-041300-generic_4.13.0-041300.201709031731_amd64.deb<br></code></pre></td></tr></table></figure>\n\n<p><img  src=\"https://pic.izhaoo.com/20170927220809.jpg\"  ><span class=\"image-caption\">安装内核</span></p>\n<p>重启查看下内核：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">shutdown -r now<br><br>uname -r<br></code></pre></td></tr></table></figure>\n\n<p>看到内核版本是最新了（&gt; 4.9），就可以开启BBR加速了。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927221102.jpg\"  ><span class=\"image-caption\">最新内核</span></p>\n<h1 id=\"开启BBR\"><a href=\"#开启BBR\" class=\"headerlink\" title=\"开启BBR\"></a>开启BBR</h1><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;net.core.default_qdisc=fq&quot;</span> &gt;&gt; /etc/sysctl.conf<br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;net.ipv4.tcp_congestion_control=bbr&quot;</span> &gt;&gt; /etc/sysctl.conf<br><br>sysctl -p<br></code></pre></td></tr></table></figure>\n\n<p>查看是否生效：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">sysctl net.ipv4.tcp_available_congestion_control<br></code></pre></td></tr></table></figure>\n\n<p>若返回“net.ipv4.tcp_available_congestion_control = bbr cubic reno”说明成功了。</p>\n<p><img  src=\"https://pic.izhaoo.com/20170927221352.jpg\"  ><span class=\"image-caption\">开启BBR</span></p>","categories":[{"name":"技术","path":"api/categories/技术.json"}],"tags":[{"name":"服务器","path":"api/tags/服务器.json"}]}