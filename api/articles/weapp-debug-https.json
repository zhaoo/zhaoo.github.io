{"title":"小程序真机调试问题","slug":"weapp-debug-https","date":"2020-02-12T12:01:25.000Z","updated":"2020-04-30T03:58:10.000Z","comments":true,"path":"api/articles/weapp-debug-https.json","realPath":"/2020/02/12/weapp-debug-https/","excerpt":"微信小程序真机调试中，绑定域名、SSL证书等问题解决方案。","covers":["https://pic.izhaoo.com/2020021285143.jpg","https://pic.izhaoo.com/2020021293503.jpg","https://pic.izhaoo.com/2020021293052.jpg"],"cover":"https://pic.izhaoo.com/20200125102711.jpg","content":"<p>微信小程序真机调试中，绑定域名、SSL证书等问题解决方案。</p>\n<span id=\"more\"></span>\n\n<p>在真机调试中，不推荐勾选<code>不校验合法域名、web-view、TLS版本以及HTTPS证书</code>，这些问题迟早要面对，还是先解决为好。</p>\n<h3 id=\"配置域名\"><a href=\"#配置域名\" class=\"headerlink\" title=\"配置域名\"></a>配置域名</h3><p>小程序中发起远程请求，包括用到的API服务，都需要到<code>微信公众平台</code>配置<code>服务器域名</code>，域名需要开启<code>https</code>，如下：</p>\n<p><img  src=\"https://pic.izhaoo.com/2020021285143.jpg\"  ><span class=\"image-caption\">服务器域名配置</span></p>\n<h3 id=\"开发调试\"><a href=\"#开发调试\" class=\"headerlink\" title=\"开发调试\"></a>开发调试</h3><p>在<code>体验版</code>、<code>开发板</code>等一些线上调试时，还需要打开<code>开发调试</code>选项，不然请求可能会访问不到。点击右上角<code>···</code>按钮，<code>开发调试</code>，<code>打开调试</code>，弹出绿色的<code>vConsole</code>即可，调试信息也会在里面打印。</p>\n<p><img  src=\"https://pic.izhaoo.com/2020021293503.jpg\"  ><span class=\"image-caption\">vConsole</span></p>\n<h3 id=\"本地请求\"><a href=\"#本地请求\" class=\"headerlink\" title=\"本地请求\"></a>本地请求</h3><p>真机调试时不允许使用本地域名，如<code>localhost</code>、<code>127.0.0.1</code>这些，但是我们又希望小程序能请求到本地以方便调试。有以下解决方案：</p>\n<ol>\n<li><p>将<code>本地服务器</code>与<code>调试手机</code>置于同一子网（同一路由器），本地服务器监听地址改为<code>0.0.0.0</code>，小程序请求地址改为本地服务器的内网地址即可，如<code>192.168.31.20</code>，可通过<code>ifconfig / ipconfig</code>查看。</p>\n</li>\n<li><p><strong>推荐</strong>通过<code>frp</code>、<code>ngrok</code>等软件进行内网穿透，将请求通过绑定域名的服务器（需开启https）进行转发。<code>frp</code>还需使用<code>http2https</code>插件进行重定向，配置本地证书。</p>\n</li>\n</ol>\n<h3 id=\"证书错误\"><a href=\"#证书错误\" class=\"headerlink\" title=\"证书错误\"></a>证书错误</h3><p>小程序对SSL证书的要求较高，许多免费的证书达不到要求，可以多试几家。本人测试，<code>宝塔面板</code>、<code>阿里云</code>无法使用，<code>腾讯云</code>可以使用。</p>\n<p>我的项目使用了<code>GraphQL</code>查询接口，用到了<code>apollo-boost</code>库。真机调试时就是访问不通，catch了错误信息<code>request:fail -202:net::ERR_CERT_AUTHORITY_INVALID</code>，也是证书错误的缘故。</p>\n<p><a href=\"https://myssl.com/\">myssl</a>可以在该网站对SSL证书进行评估，一般达到<code>A级</code>以上才能使用，且必须支持<code>TLS 1.2</code>、<code>TLS 1.1</code>、<code>TLS 1.0</code>。在页面下方还可以查看支持访问的设备。</p>\n<p><img  src=\"https://pic.izhaoo.com/2020021293052.jpg\"  ><span class=\"image-caption\">支持设备</span></p>\n","more":"<p>在真机调试中，不推荐勾选<code>不校验合法域名、web-view、TLS版本以及HTTPS证书</code>，这些问题迟早要面对，还是先解决为好。</p>\n<h3 id=\"配置域名\"><a href=\"#配置域名\" class=\"headerlink\" title=\"配置域名\"></a>配置域名</h3><p>小程序中发起远程请求，包括用到的API服务，都需要到<code>微信公众平台</code>配置<code>服务器域名</code>，域名需要开启<code>https</code>，如下：</p>\n<p><img  src=\"https://pic.izhaoo.com/2020021285143.jpg\"  ><span class=\"image-caption\">服务器域名配置</span></p>\n<h3 id=\"开发调试\"><a href=\"#开发调试\" class=\"headerlink\" title=\"开发调试\"></a>开发调试</h3><p>在<code>体验版</code>、<code>开发板</code>等一些线上调试时，还需要打开<code>开发调试</code>选项，不然请求可能会访问不到。点击右上角<code>···</code>按钮，<code>开发调试</code>，<code>打开调试</code>，弹出绿色的<code>vConsole</code>即可，调试信息也会在里面打印。</p>\n<p><img  src=\"https://pic.izhaoo.com/2020021293503.jpg\"  ><span class=\"image-caption\">vConsole</span></p>\n<h3 id=\"本地请求\"><a href=\"#本地请求\" class=\"headerlink\" title=\"本地请求\"></a>本地请求</h3><p>真机调试时不允许使用本地域名，如<code>localhost</code>、<code>127.0.0.1</code>这些，但是我们又希望小程序能请求到本地以方便调试。有以下解决方案：</p>\n<ol>\n<li><p>将<code>本地服务器</code>与<code>调试手机</code>置于同一子网（同一路由器），本地服务器监听地址改为<code>0.0.0.0</code>，小程序请求地址改为本地服务器的内网地址即可，如<code>192.168.31.20</code>，可通过<code>ifconfig / ipconfig</code>查看。</p>\n</li>\n<li><p><strong>推荐</strong>通过<code>frp</code>、<code>ngrok</code>等软件进行内网穿透，将请求通过绑定域名的服务器（需开启https）进行转发。<code>frp</code>还需使用<code>http2https</code>插件进行重定向，配置本地证书。</p>\n</li>\n</ol>\n<h3 id=\"证书错误\"><a href=\"#证书错误\" class=\"headerlink\" title=\"证书错误\"></a>证书错误</h3><p>小程序对SSL证书的要求较高，许多免费的证书达不到要求，可以多试几家。本人测试，<code>宝塔面板</code>、<code>阿里云</code>无法使用，<code>腾讯云</code>可以使用。</p>\n<p>我的项目使用了<code>GraphQL</code>查询接口，用到了<code>apollo-boost</code>库。真机调试时就是访问不通，catch了错误信息<code>request:fail -202:net::ERR_CERT_AUTHORITY_INVALID</code>，也是证书错误的缘故。</p>\n<p><a href=\"https://myssl.com/\">myssl</a>可以在该网站对SSL证书进行评估，一般达到<code>A级</code>以上才能使用，且必须支持<code>TLS 1.2</code>、<code>TLS 1.1</code>、<code>TLS 1.0</code>。在页面下方还可以查看支持访问的设备。</p>\n<p><img  src=\"https://pic.izhaoo.com/2020021293052.jpg\"  ><span class=\"image-caption\">支持设备</span></p>","categories":[{"name":"前端","path":"api/categories/前端.json"}],"tags":[{"name":"前端","path":"api/tags/前端.json"}]}